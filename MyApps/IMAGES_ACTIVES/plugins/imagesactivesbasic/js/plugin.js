jQuery.fn.imagesActivesBasic=function(b){var a={init:function(e){var c=$(this);this.imagesActivesBasic.settings=jQuery.extend({},this.imagesActivesBasic.defaults,e);if(e.options){var d=jQuery.fn.imagesActivesBasic.xmlConversion(e.options);return this.each(function(){c.imagesActivesBasic("createObjects",d)})}else{if(e.optionsFile){return this.each(function(){jQuery.ajax({type:"GET",url:e.optionsFile,dataType:"xml",context:c,success:function(f){c.imagesActivesBasic("createObjects",f)},error:function(f,h,g){jQuery.error("response: "+f.responseText);jQuery.error("code: "+f.getResponseHeader("X-Subscriber-Status"))}})})}else{jQuery.error("You must provide options in xml format either as a file or as plain text.")}}},createObjects:function(e){var c=new jQuery.fn.imagesActivesBasic.DAO(this,e);var d=new jQuery.fn.imagesActivesBasic.UI(this,c);var f=new jQuery.fn.imagesActivesBasic.Control(d,c)}};if(a[b]){return a[b].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof b==="object"||!b){return a.init.apply(this,arguments)}else{jQuery.error('Method "'+b+'" does not exist in imagesActivesBasic plugin!')}}};jQuery.fn.imagesActivesBasic.xmlConversion=function(a){if(window.ActiveXObject){xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(a);return xmlDoc}else{if(document.implementation&&document.implementation.createDocument){parser=new DOMParser();xmlDoc=parser.parseFromString(a,"text/xml");return xmlDoc}}};jQuery.fn.imagesActivesBasic.patterns={DETAIL:/^detail\d+$/,NAVBAR_KEY:/^index_detail\d+$/};jQuery.fn.imagesActivesBasic.defaults={unity:0.03,panels_hiding_delay:3000,panels_sliding_duration:500,min_textbox_width:0.3,min_textbox_height:0.3,zoom_margin:6,zoom_interpolation_frames:10,credit_image_proportion:0.85,details_navbar_max_item:5,embedBitmaps:"noembed",embedSvgIcons:"noembed",topBar:0,handleOpacity:0.7,details_hover_animation_delay:400};jQuery.fn.imagesActivesBasic.settings={};jQuery.fn.imagesActivesBasic.DAO=function(a,b){this.svg=a[0];this.data=b;this.data=this.getElementByTagNameNSPortable(this.data,"images_actives","project");this.collectInformation()};jQuery.fn.imagesActivesBasic.DAO.namespaces={images_actives:"http://www.crdp.ac_versailles.fr/2011/images_actives",quiz:"http://www.crdp.ac_versailles.fr/2011/images_actives/behaviors/quiz",discovery:"http://www.crdp.ac_versailles.fr/2011/images_actives/behaviors/discovery",};jQuery.fn.imagesActivesBasic.DAO.OVERALL_DESCRIPTION="overall_description";jQuery.fn.imagesActivesBasic.DAO.LINK_WITH_SPACE_AFTER_AROBASE_PATTERN=/([^@]+)@\s+([^\}]*[^\s\}])\s*\}/;jQuery.fn.imagesActivesBasic.DAO.LINK_WITH_FINAL_SPACE_PATTERN=/([^@]+)@\s*([^\}]*[^\s\}])\s+\}/;jQuery.fn.imagesActivesBasic.DAO.LINK_PATTERN=/\{([^@]*[^\s@])@([^\}]*[^\s\}@])\}/;jQuery.fn.imagesActivesBasic.DAO.prototype={getTitle:function(){return this.title},getDetailTitle:function(a){return this.captions[a].title},getDetailDesc:function(a){return this.captions[a].desc},collectInformation:function(){this.captions=new Object();var b;for(var a in this.svg.childNodes){b=this.svg.childNodes[a];switch(b.nodeName){case"title":this.title=b.textContent;b.textContent="";break;case"metadata":this.extractMetaData(b.firstElementChild.firstElementChild);break;default:if(b&&b.id){if(b.id.match(jQuery.fn.imagesActivesBasic.patterns.DETAIL)){if(this.hasOnlyEmptyText(b)){b.setAttribute("empty","empty")}else{this.extractDetailInformation(b)}}else{if(b.nodeName=="image"&&b.id=="background"){this.extractBackgroundInformation(b)}}}break}}},hasOnlyEmptyText:function(a){return a&&a.tagName!="image"&&a.childElementCount==2&&a.getElementsByTagName("title").length==1&&a.getElementsByTagName("desc").length==1&&a.getElementsByTagName("title")[0].textContent.match(/^\s*$/)&&a.getElementsByTagName("desc")[0].textContent.match(/^\s*$/)},extractDetailInformation:function(b){var e=b.getElementsByTagName("title")[0];var a=b.getElementsByTagName("desc")[0];var d=e?e.textContent:"";var c=a?a.textContent:"";c=this.insertLinks(c);if(e){e.textContent=""}if(a){a.textContent=""}this.captions[b.id]={title:d,desc:c}},insertLinks:function(a){a=this.replaceByLink(jQuery.fn.imagesActivesBasic.DAO.LINK_WITH_SPACE_AFTER_AROBASE_PATTERN,a);a=this.replaceByLink(jQuery.fn.imagesActivesBasic.DAO.LINK_WITH_FINAL_SPACE_PATTERN,a);a=this.replaceByLink(jQuery.fn.imagesActivesBasic.DAO.LINK_PATTERN,a);return a},replaceByLink:function(a,b){return b.replace(a,'<a href="$2" target="_blank">$1</a>')},extractBackgroundInformation:function(b){var d=b.getElementsByTagName("title")[0];var a=b.getElementsByTagName("desc")[0];var e=d?d.textContent:"";var c=a?a.textContent:"";if(d){d.textContent=""}if(a){a.textContent=""}this.captions[jQuery.fn.imagesActivesBasic.DAO.OVERALL_DESCRIPTION]={title:e,desc:c}},extractMetaData:function(a){this.captions.metadata={title:this.extractMetadataNodeContent(a,"title"),source:this.extractMetadataNodeContent(a,"source"),infos:this.extractMetadataNodeContent(a,"infos"),rights:this.extractMetadataNodeContent(a,"rights",true),creator:this.extractMetadataNodeContent(a,"creator",true),date:this.extractMetadataNodeContent(a,"date")};jQuery(a).empty()},getMetadataTitle:function(){return this.captions.metadata.title},getMetadataContent:function(){var b="";for(var a in this.captions.metadata){if(a=="title"){continue}if(!this.captions.metadata[a].match(/^\s*$/)){b+="<p>"+this.captions.metadata[a]+"</p>"}}return b},extractMetadataNodeContent:function(b,e,a){var d=b.getElementsByTagName("dc:"+e)[0];if(a&&d){d=d.getElementsByTagName("cc:Agent")[0];if(d){d=d.getElementsByTagName("dc:title")[0]}}var c="";if(d){c=d.textContent}return c},getColorParameter:function(a){return jQuery(this.data).find("#"+a).text()},getCommonInteractivityParameter:function(a){var b=this.getElementByTagNameNSPortable(this.data,"images_actives","common_interactivity_parameters");return this.getElementByTagNameNSPortable(b,"images_actives",a).firstChild.data},getSpecificInteractivityParameter:function(a){var b=this.getElementByTagNameNSPortable(this.data,"images_actives","specific_interactivity_parameters");return this.getElementByTagNameNSPortable(b,this.getInteractivityType(),a).firstChild.data},getInteractivityType:function(){var a=this.getElementByTagNameNSPortable(this.data,"images_actives","specific_interactivity_parameters");return this.getAttributeNSPortable(a,"interactivity_type")},getSpecificText:function(a){var b=this.getElementByTagNameNSPortable(this.data,"images_actives","specific_texts");return this.getElementByTagNameNSPortable(b,this.getInteractivityType(),a).firstChild.data},getBehaviorNamespace:function(a){return jQuery.fn.imagesActivesBasic.DAO.mainNS+"/behaviors/"+this.getInteractivityType()},getElementByTagNameNSPortable:function(a,c,b){if(!jQuery.browser.msie){return a.getElementsByTagNameNS(jQuery.fn.imagesActivesBasic.DAO.namespaces[c],b)[0]}return a.getElementsByTagName(c+":"+b)[0]},getAttributeNSPortable:function(b,a){if(!jQuery.browser.msie){return b.getAttributeNS(null,a)}return b.getAttribute(a)}};jQuery.fn.imagesActivesBasic.UI=function(b,a){this.svg=b[0];this.dao=a;this.determinateDevice();this.handleResize();this.wrapSVG();this.createHeader();this.createHeaderHandle();this.createHeaderButtons();this.createHeaderScrollArrows();this.createFooter();this.createFooterHandle();this.createTextBox();this.parseSVG();this.createCreditPanel();this.organizeNavbar();this.createShader();this.detailsOpacity(0);this.fitToViewport(null);this.listenToInteractions();$(this.svg).css("opacity",1)};jQuery.fn.imagesActivesBasic.UI.buttons={INFOS:"infos",DETAILS:"details",METADATA:"metadata",DESCRIPTION:"description"};jQuery.fn.imagesActivesBasic.UI.svgNS="http://www.w3.org/2000/svg";jQuery.fn.imagesActivesBasic.userEvents={HOVER_DETAIL:"hover_detail",SELECT_DETAIL:"select_detail",UNSELECT_DETAIL:"unselect_detail",CLICK_HEADER_TAB:"click_header_tab",CLICK_FOOTER_TAB:"click_footer_tab",CLICK_OUTSIDE_DETAIL:"click_outside_detail",DISPLAY_ALL_DETAILS:"display_all_details",DISPLAY_DESCRIPTION:"display_description",DISPLAY_METADATA:"display_metadata",ZOOM_FINISHED:"zoom_finished",HIDE_TEXT_BOX:"hide_text_box",DISPLAY_ANSWER:"diplay_answer",VALID_PASSWORD:"valid_password",STOP_HEADER_AUTOMATIC_REMOVAL:"stop_header_automatic_removal",STOP_FOOTER_AUTOMATIC_REMOVAL:"stop_footer_automatic_removal"};jQuery.fn.imagesActivesBasic.pcEvents=["mousedown","mouseover","mouseout"];jQuery.fn.imagesActivesBasic.mobileEvents=["touchstart","touchmove","gesturestart","gesturechange","gestureend"];jQuery.fn.imagesActivesBasic.UI.prototype={determinateDevice:function(){this.mobile=(/iphone|ipad|ipod|android|blackberry|mini|windows\sce|palm/i.test(navigator.userAgent.toLowerCase()))},handleResize:function(){if(this.mobile){window.addEventListener(this.mobile?"orientationchange":"resize",jQuery.proxy(this,"fitToViewport"),true)}else{window.addEventListener("resize",jQuery.proxy(this,"fitToViewport"),true)}},wrapSVG:function(){this.container=jQuery(document.createElement("div"));this.container.addClass("container-image-active");this.upperElement=jQuery(this.svg).parent();this.container.append(jQuery(this.svg));this.upperElement.append(this.container)},parseSVG:function(){this.detailNodes=new Object();this.detailsDimensions=new Object();this.detailsCaptionsAvailableSpace=new Object();for(var a in this.svg.childNodes){node=this.svg.childNodes[a];if(this.isDetail(node)){this.detailNodes[node.id]=node}else{if(this.isBackground(node)){this.background=node}}}this.getBackgroundSize();this.setOverallDescriptionDisplaySpace();this.processDetails()},setOverallDescriptionDisplaySpace:function(){this.detailsCaptionsAvailableSpace[jQuery.fn.imagesActivesBasic.DAO.OVERALL_DESCRIPTION]={top:0,left:0,width:this.imageWidth,height:this.imageHeight}},processDetails:function(){this.previousDetailButton=this.addItemToNavBar("previous_detail","<");var c;var a=0;for(var b in this.detailNodes){a++;c=this.detailNodes[b];this.detailsDimensions[b]=c.getBoundingClientRect();this.calculateDetailCaptionAvailableSpace(b);c.setAttributeNS(null,"class","detail");if(!this.isPuce(c)){this.convertToClipPath(c)}this.addDetailToNavBar(b,a)}this.nextDetailButton=this.addItemToNavBar("next_detail",">")},addDetailToNavBar:function(a,b){this.addItemToNavBar("index_"+a,b)},addItemToNavBar:function(c,b){var a=jQuery(document.createElement("span"));a.attr("id",c);a.text(""+b);this.footerContent.append(a);return a},organizeNavbar:function(){var b=this.footer.find("span");var a=b.length-2;if(a<=jQuery.fn.imagesActivesBasic.settings.details_navbar_max_item){this.nextDetailButton.hide();this.previousDetailButton.hide()}else{this.firstNavbarButtonDisplayed=1;this.handleNavbarOverflow()}},handleNavbarOverflow:function(){var b=this.footer.find("span");this.previousDetailButton.toggleClass("disabled",this.firstNavbarButtonDisplayed==1);this.nextDetailButton.toggleClass("disabled",this.firstNavbarButtonDisplayed>(b.length-2-jQuery.fn.imagesActivesBasic.settings.details_navbar_max_item));for(var a=1;a<b.length-1;a++){$(b[a]).toggle(a>=this.firstNavbarButtonDisplayed&&a<this.firstNavbarButtonDisplayed+jQuery.fn.imagesActivesBasic.settings.details_navbar_max_item)}},navigateInNavbar:function(a){this.firstNavbarButtonDisplayed+=a;this.firstNavbarButtonDisplayed=Math.max(1,Math.min(this.firstNavbarButtonDisplayed,this.footer.find("span").length-1-jQuery.fn.imagesActivesBasic.settings.details_navbar_max_item));this.handleNavbarOverflow()},calculateDetailCaptionAvailableSpace:function(b){var e=this.detailsDimensions[b];var a=new Object();a.up={width:this.imageWidth,height:Math.max(0,e.top),top:0,left:0};a.down={width:this.imageWidth,height:this.imageHeight-Math.min(this.imageHeight,e.bottom),top:Math.max(0,e.bottom),left:0};a.right={width:this.imageWidth-Math.min(e.right,this.imageWidth),height:this.imageHeight,top:0,left:Math.max(0,e.right)};a.left={width:Math.max(0,e.left),height:this.imageHeight,top:0,left:0};var g=0;var d="";var f=0;for(var c in a){f=a[c].width*a[c].height;if(f>=g){d=c;g=f}}if(this.isTooSmall(a[d])){this.detailsCaptionsAvailableSpace[b]={top:0,left:0,width:this.imageWidth,height:this.imageHeight*0.5}}else{this.detailsCaptionsAvailableSpace[b]=a[d]}},isTooSmall:function(a){return a.width<jQuery.fn.imagesActivesBasic.settings.min_textbox_width*this.imageWidth||a.height<jQuery.fn.imagesActivesBasic.settings.min_textbox_height*this.imageHeight},convertToClipPath:function(b){var a=document.createElementNS(jQuery.fn.imagesActivesBasic.UI.svgNS,"clipPath");a.setAttributeNS(null,"id","clip_"+b.id);b.setAttributeNS(null,"clip-path","url(#clip_"+b.id+")");jQuery(a).append(jQuery(b).find("*").not("g").not("title").not("desc"));jQuery(b).empty();this.getOrCreateDefsNode().appendChild(a);var d=this.dao.getCommonInteractivityParameter("shading_color");var c=document.createElementNS(jQuery.fn.imagesActivesBasic.UI.svgNS,"rect");c.setAttributeNS(null,"width",this.imageWidth);c.setAttributeNS(null,"height",this.imageHeight);c.setAttributeNS(null,"style","fill:#"+d.replace("0x",""));var e=this.background.cloneNode(false);b.appendChild(e);b.appendChild(c)},getOrCreateDefsNode:function(){if(!this.defs){var a=this.svg.getElementsByTagName("defs");if(a.length>0){this.defs=a[0]}else{this.defs=document.createElementNS(jQuery.fn.imagesActivesBasic.UI.svgNS,"defs");this.svg.appendChild(this.defs)}}return this.defs},getDef:function(a){if(!this.defs){return null}return jQuery(this.defs).find("#clip_"+a)},createShader:function(){this.shader=document.createElementNS(jQuery.fn.imagesActivesBasic.UI.svgNS,"rect");this.shader.setAttributeNS(jQuery.fn.imagesActivesBasic.UI.svgNS,"id","shader");this.shader.setAttribute("visibility","hidden");this.shader.setAttributeNS(null,"width",this.imageWidth);this.shader.setAttributeNS(null,"height",this.imageHeight);this.shader.setAttributeNS(null,"style","fill:#000000");$(this.shader).insertAfter(this.background)},displayShader:function(a,c,b){this.shader.setAttributeNS(null,"style","fill:#"+a.replace("0x",""));this.shader.setAttribute("visibility","visible");$(this.shader).attr("opacity",0);$(this.shader).animate({opacity:c},jQuery.fn.imagesActivesBasic.settings.details_hover_animation_delay)},hideShader:function(){this.shader.setAttribute("visibility","hidden")},fitToViewport:function(c){var b=window.innerHeight;this.topMargin=0;var a=(this.imageHeight/this.imageWidth)>(1024/768);if(a&&jQuery.fn.imagesActivesBasic.settings.topBar>0&&this.imageHeight+jQuery.fn.imagesActivesBasic.settings.topBar>1024){b=window.innerHeight-jQuery.fn.imagesActivesBasic.settings.topBar;this.topMargin=jQuery.fn.imagesActivesBasic.settings.topBar}this.scaleFactor=Math.min(window.innerWidth/this.imageWidth,b/this.imageHeight);this.unity=parseFloat(this.baseUnity)*parseFloat(this.scaleFactor);this.scale();this.center();this.resizeContainer();this.resizeHeader();this.resizeFooter();this.resizeCreditPanel();this.resizeTextBox();this.resizeFilter()},resizeContainer:function(){this.container.css("height",this.imageHeight*this.scaleFactor);this.container.css("width",this.imageWidth*this.scaleFactor);$(this.svg).css("height",this.imageHeight*this.scaleFactor);$(this.svg).css("width",this.imageWidth*this.scaleFactor)},resizeHeader:function(){this.header.css("width",this.imageWidth*this.scaleFactor-this.unity/2);this.header.css("padding",(this.unity/4)+"px");this.header.css("font-size",this.unity*1.5);this.header.css("height",this.unity*2.5);if(!this.headerVisible){this.header.css("top",-this.header.height()-this.unity)}var b,c;for(var a in this.headerButtons){b=this.headerButtons[a];c=b.find("img,svg");c.css("width",this.unity*1.5);c.css("height",this.unity*1.5);b.css("margin-left",this.unity*0.5);b.css("margin-top",this.unity*0.25);b.css("width",this.unity*1.5);b.css("height",this.unity*1.5);b.css("padding",this.unity*0.15)}if(this.mobile){this.title.css("overflow-x","auto")}var d=this.unity*4.5;this.titleWidth=this.header.width()-this.headerButtonContainer.width()-d-this.unity/2;this.title.scrollLeft(0);this.title.css("width","auto");this.showArrow("left",false);this.leftScrollArrow.css("margin-left",d);if(this.title.width()>this.titleWidth){this.showArrow("right",true);this.title.css("margin-left",0);this.rightScrollArrow.css("margin-left",this.unity/4);this.leftScrollArrow.css("margin-right",this.unity/4);this.title.width(this.titleWidth-this.unity*0.5)}else{this.showArrow("right",false);this.title.width(this.titleWidth)}this.headerHandleUp.height(this.unity*3.5);this.headerHandleUp.width(this.unity*3.5);this.headerHandleDown.height(this.unity*3.5);this.headerHandleDown.width(this.unity*3.5);this.headerHandleUp.css("left",this.unity/2);this.headerHandleDown.css("left",this.unity/2);this.headerHandleUp.css("top",-this.unity/2);this.headerHandleDown.css("top",-this.unity/2)},scrollTitle:function(a){if(this.scrollMotion){clearInterval(this.scrollMotion)}this.showArrow("left",a!="left");this.showArrow("right",a=="left");if(a=="left"){this.title.scrollLeft(0)}else{this.offset=this.unity/2;this.scrollMotion=setInterval($.proxy(this,"autoScrollTitle"),100)}},autoScrollTitle:function(a){this.title.scrollLeft(this.title.scrollLeft()+this.offset);if(this.title.scrollLeft()+this.title.get(0).offsetWidth>=this.title.get(0).scrollWidth){clearInterval(this.scrollMotion)}},showArrow:function(c,a){var b=c=="left"?this.leftScrollArrow:this.rightScrollArrow;if(b.is("img")){b.width(a?this.unity/2:0.01)}else{b.find("img,svg").width(a?this.unity/2:0)}if(c=="right"){b.css("margin-right",a?-this.unity/2:0);this.title.css("margin-right",a?0:-this.unity/2)}},updateArrows:function(){if(this.scrollMotion){clearInterval(this.scrollMotion)}var b=this.title.scrollLeft()==0;var a=this.title.scrollLeft()+this.title.get(0).offsetWidth>=this.title.get(0).scrollWidth;this.showArrow("left",!b);this.showArrow("right",!a);this.title.width(this.titleWidth-(b?0:this.unity/2)-(a?0:this.unity/2))},resizeFooter:function(){this.footer.css("width",this.imageWidth*this.scaleFactor-this.unity/2);this.footer.css("bottom",0);this.footer.css("padding",(this.unity/4)+"px");this.footer.css("font-size",this.unity*1.5);this.footer.css("height",this.unity*2.5);this.footerHandleUp.height(this.unity*3.5);this.footerHandleUp.width(this.unity*3.5);this.footerHandleDown.height(this.unity*3.5);this.footerHandleDown.width(this.unity*3.5);this.footerHandleUp.css("left",this.unity/2);this.footerHandleDown.css("left",this.unity/2);this.footerHandleUp.css("bottom",-this.unity/2);this.footerHandleDown.css("bottom",-this.unity/2);if(!this.footerVisible){this.footer.css("bottom",-this.footer.height()-this.unity*0.5)}},resizeCreditPanel:function(){if(!this.creditPanel.is(":visible")){return}this.evaluateProportions();if(this.resizeImageByWidth){this.flexibleWidth(this.creditImage,this.imageWidth*this.scaleFactor*jQuery.fn.imagesActivesBasic.settings.credit_image_proportion);this.flexibleHeight(this.creditImage,this.imageWidth*this.scaleFactor*jQuery.fn.imagesActivesBasic.settings.credit_image_proportion)}else{this.flexibleWidth(this.creditImage,this.imageHeight*this.scaleFactor*jQuery.fn.imagesActivesBasic.settings.credit_image_proportion);this.flexibleWidth(this.creditImage,this.imageHeight*this.scaleFactor*jQuery.fn.imagesActivesBasic.settings.credit_image_proportion)}this.creditPanel.css("left",($(this.svg).width()-this.creditImage.width())/2);this.creditPanel.css("top",($(this.svg).height()-this.creditImage.height())/2);this.creditPanel.css("height",this.creditImage.height());this.creditPanelCloseButton.css("top",this.unity/2);this.creditPanelCloseButton.css("right",this.unity/2);this.creditPanelCloseButton.css("width",this.unity*1.5);this.creditPanelCloseButton.css("height",this.unity*1.5)},flexibleHeight:function(b,a){if(b.is("img")){b.height(a)}else{b.find("svg").css("height",a)}},flexibleWidth:function(b,a){if(b.is("img")){b.width(a)}else{b.find("svg").css("width",a)}},createCreditPanel:function(){this.creditPanel=jQuery(document.createElement("div"));this.creditPanel.attr("id","credit-panel");this.creditPanelCloseButton=this.createVectorImage("close");this.creditPanelCloseButton.attr("class","close-button");this.creditImage=this.createVectorImage("credits");this.evaluateProportions();this.creditPanel.append(this.creditPanelCloseButton).append(this.creditImage);jQuery(this.footer).after(this.creditPanel);this.displayCreditPanel(false)},evaluateProportions:function(){var b=this.creditImage.find("svg");var c=jQuery.fn.imagesActivesBasic.settings.embedSvgIcons=="embed"?b.get(0).width.baseVal.value:this.creditImage.get(0).width;var a=jQuery.fn.imagesActivesBasic.settings.embedSvgIcons=="embed"?b.get(0).height.baseVal.value:this.creditImage.get(0).height;this.creditImageProportion=c/a;this.resizeImageByWidth=this.creditImageProportion>(this.imageWidth/this.imageHeight)},displayCreditPanel:function(a){if(!a){this.creditPanel.hide()}else{this.creditPanel.show();this.resizeCreditPanel();this.creditPanel.fadeIn()}},createHeader:function(){this.header=jQuery(document.createElement("header"));this.title=jQuery(document.createElement("span"));this.title.attr("id","main-title");this.title.addClass("horizontal-scroll");this.title.text(this.dao.getTitle());this.header.addClass("title");this.header.append(this.title);jQuery(this.svg).before(this.header)},createHeaderHandle:function(){this.headerHandleUp=this.createVectorImage("bouton-header-handle-up");this.headerHandleUp.attr("class","bouton-header-handle");this.headerHandleDown=this.createVectorImage("bouton-header-handle-down");this.headerHandleDown.attr("class","bouton-header-handle");this.headerHandleDown.css("opacity",jQuery.fn.imagesActivesBasic.settings.handleOpacity);this.header.after(this.headerHandleUp);this.header.after(this.headerHandleDown);this.updateHeaderHandleIcon()},createFooter:function(){this.footer=jQuery(document.createElement("footer"));this.footerContent=jQuery(document.createElement("div"));this.footer.append(this.footerContent);jQuery(this.svg).after(this.footer)},createFooterHandle:function(){this.footerHandleUp=this.createVectorImage("bouton-footer-handle-up");this.footerHandleUp.attr("class","bouton-footer-handle");this.footerHandleUp.css("opacity",jQuery.fn.imagesActivesBasic.settings.handleOpacity);this.footerHandleDown=this.createVectorImage("bouton-footer-handle-down");this.footerHandleDown.attr("class","bouton-footer-handle");this.footer.before(this.footerHandleUp);this.footer.before(this.footerHandleDown)},createHeaderButtons:function(){this.headerButtons=new Object();this.headerButtonContainer=jQuery(document.createElement("div"));this.header.append(this.headerButtonContainer);for(var a in jQuery.fn.imagesActivesBasic.UI.buttons){this.headerButtons[jQuery.fn.imagesActivesBasic.UI.buttons[a]]=this.createHeaderButton(a);this.headerButtonContainer.append(this.headerButtons[jQuery.fn.imagesActivesBasic.UI.buttons[a]])}},createHeaderButton:function(c){var b=jQuery(document.createElement("span"));b.addClass("header-button");var a=this.createVectorImage(jQuery.fn.imagesActivesBasic.UI.buttons[c]);b.append(a);return b},createHeaderScrollArrows:function(){this.leftScrollArrow=this.createHeaderScrollArrow("element-fleche-g");this.rightScrollArrow=this.createHeaderScrollArrow("element-fleche-d");this.title.before(this.leftScrollArrow);this.title.after(this.rightScrollArrow)},createHeaderScrollArrow:function(b){var a=this.createVectorImage(b);a.addClass("scroll-arrow");return a},createTextBox:function(){this.textBox=jQuery(document.createElement("div"));this.textBoxTitle=jQuery(document.createElement("div"));this.textBoxCloseButton=this.createVectorImage("close");this.textBoxTitle.addClass("caption_title");this.textBoxDesc=jQuery(document.createElement("div"));this.textBoxDesc.addClass("caption_text");this.textBox.addClass("caption_box").append(this.textBoxCloseButton).append(this.textBoxTitle).append(this.textBoxDesc);jQuery(this.svg).before(this.textBox);if(this.dao.getInteractivityType()=="quiz"){this.textBoxTitle.after(this.createAnswerButton())}if(this.dao.getInteractivityType()=="quiz"&&this.dao.getSpecificInteractivityParameter("quiz_lock")==1){this.textBoxTitle.after(this.createPasswordInput())}this.hideCaption()},detailsOpacity:function(c){var b;for(var a in this.svg.childNodes){b=this.svg.childNodes[a];if(this.isDetail(b)&&!this.isPuce(b)){this.detailOpacity(b,c)}}},detailOpacity:function(a,b){a.setAttribute("opacity",b)},scale:function(){var a=this.svg.childNodes;var c;for(var b in a){c=a[b];if(this.isDetail(c)||this.isBackground(c)||c==this.shader){c.setAttribute("transform","scale("+this.scaleFactor+")")}}},center:function(){var a=this.imageWidth*this.scaleFactor;var c=this.imageHeight*this.scaleFactor;var d=(window.innerWidth-a)/2;var b=(window.innerHeight-c-jQuery.fn.imagesActivesBasic.settings.topBar)/2;this.container.css("left",Math.max(0,d));this.container.css("top",this.topMargin+Math.max(0,b));this.container.css("clip","rect(0px, 0px, "+a+"px, "+c+"px)")},lookForDetail:function(a){while(!this.isDetail(a)){a=a.parentNode;if(!a||a==this.svg){return null}}return a},lookForHeaderButton:function(b){for(var a in this.headerButtons){if($(b).closest("span.header-button").is(this.headerButtons[a])){return a}}return null},lookForTitleScrollButton:function(a){if($(a).closest(".scroll-arrow").is(this.leftScrollArrow)){return this.leftScrollArrow}if($(a).closest(".scroll-arrow").is(this.rightScrollArrow)){return this.rightScrollArrow}return null},isDetail:function(a){return a&&a.id!=undefined&&a.id.match(jQuery.fn.imagesActivesBasic.patterns.DETAIL)&&!a.hasAttribute("empty")},isNavbarKey:function(a){return a&&a.id!=undefined&&a.id.match(jQuery.fn.imagesActivesBasic.patterns.NAVBAR_KEY)},isPuce:function(a){return a.getAttribute("images_actives:puce")=="true"},isZoomable:function(a){return a.getAttribute("images_actives:zoomable")=="true"},isDetailZoomable:function(a){return this.isZoomable(this.detailNodes[a])},isBackground:function(a){return a&&a.id!=undefined&&a.id=="background"},getBackgroundSize:function(){this.imageWidth=parseInt(this.background.getAttributeNS(null,"width"));this.imageHeight=parseInt(this.background.getAttributeNS(null,"height"));this.baseUnity=parseInt(jQuery(this.svg).imagesActivesBasic.settings.unity*(this.imageHeight+this.imageWidth)/2)},displayHeader:function(b){if(this.header.attr("moving")=="moving"){return false}var a=this.header;this.header.attr("moving","moving");this.headerVisible=b;this.updateHeaderHandleIcon();this.header.animate({top:b?0:-this.header.height()-this.unity},jQuery(this.svg).imagesActivesBasic.settings.panels_sliding_duration,function(){a.removeAttr("moving")});this.resizeTextBox();return true},updateHeaderHandleIcon:function(){this.headerHandleUp.toggle(this.headerVisible);this.headerHandleDown.toggle(!this.headerVisible)},displayFooter:function(b){if(this.footer.attr("moving")=="moving"){return false}var a=this.footer;this.footer.attr("moving","moving");this.footerVisible=b;this.updateFooterHandleIcon();this.footer.animate({bottom:b?0:-this.footer.height()-this.unity*0.5},jQuery(this.svg).imagesActivesBasic.settings.panels_sliding_duration,function(){a.removeAttr("moving")});this.resizeTextBox();return true},updateFooterHandleIcon:function(){this.footerHandleUp.toggle(!this.footerVisible);this.footerHandleDown.toggle(this.footerVisible)},displayCaption:function(a,c,b){this.textBoxSpace=this.detailsCaptionsAvailableSpace[a];this.textBoxTitle.text(this.convertLineBreaks(c));this.textBoxDesc.html(this.convertLineBreaks(b));this.textBoxVisible=true;this.textBox.fadeIn();this.resizeTextBox()},convertLineBreaks:function(a){return a.replace(/\n/g,"<br/>")},displayAnswerButton:function(a){this.answerButton.toggle(a)},displayPasswordInput:function(a){if(!this.passwordInput){return}this.passwordInput.toggle(a);if(!a){this.passwordInput.keypad("hide")}else{this.passwordInput.val("")}},createAnswerButton:function(){this.answerButton=jQuery(document.createElement("input"));this.answerButton.attr("value",this.dao.getSpecificText("answer_button"));this.answerButton.attr("type","button");this.answerButton.addClass("answer_button");return this.answerButton},createPasswordInput:function(){this.passwordInput=jQuery(document.createElement("input"));this.passwordInput.attr("type","password");this.passwordInput.attr("placeholder",this.dao.getSpecificText("password_box_label"));this.passwordInput.addClass("password_input");$.keypad.setDefaults({layout:["123","456","789","0"+$.keypad.ENTER],enterText:"OK",enterStatus:""});this.passwordInput.keypad();return this.passwordInput},hideCaption:function(){this.textBox.hide();this.textBoxVisible=false},resizeTextBox:function(){if(!this.textBoxVisible){return}this.textBox.css("left",this.textBoxSpace.left*this.scaleFactor+this.unity);var b=this.textBoxSpace.top*this.scaleFactor+this.unity;if(this.headerVisible){b+=2.5*this.unity}this.textBox.css("top",b);this.textBox.css("width",this.textBoxSpace.width*this.scaleFactor-3*this.unity);this.textBoxTitle.css("font-size",this.unity*1.2);this.textBoxDesc.css("font-size",this.unity*0.9);if(this.passwordInput){this.passwordInput.css("font-size",this.unity*0.9)}this.textBoxDesc.css("padding-right",this.unity*0.5);this.textBoxTitle.css("margin-bottom",this.unity*0.5);this.textBox.children("img").width(this.unity*1.3);var a=this.textBoxSpace.height*this.scaleFactor-this.textBoxTitle.height()-4.5*this.unity;if(this.headerVisible){a-=2.5*this.unity}if(this.footerVisible){a-=2.5*this.unity}this.textBoxDesc.css("max-height",a);this.textBoxDesc.css("overflow-y",this.textBoxDesc.get(0).scrollHeight>this.textBoxDesc.get(0).clientHeight?"scroll":"hidden");this.textBox.css("padding",this.unity/2);this.textBoxDesc.css("padding-top",this.unity/2);this.textBoxDesc.css("padding-bottom",this.unity/2);this.textBox.css("border-radius",this.unity/2);this.textBoxCloseButton.width(this.unity*1.5);this.textBoxCloseButton.height(this.unity*1.5);if(this.passwordInput&&this.passwordInput.is(":visible")){this.passwordInput.keypad("show")}},resizeFilter:function(){var b=document.getElementById("dropshadow");var a=b.firstElementChild;a.setAttribute("dx",this.unity*0.75);a.setAttribute("dy",this.unity*0.75)},listenToInteractions:function(){if(this.mobile){for(var a in jQuery.fn.imagesActivesBasic.mobileEvents){document.addEventListener(jQuery.fn.imagesActivesBasic.mobileEvents[a],jQuery.proxy(this,"handleUserAction"),true)}}else{for(var a in jQuery.fn.imagesActivesBasic.pcEvents){document.addEventListener(jQuery.fn.imagesActivesBasic.pcEvents[a],jQuery.proxy(this,"handleUserAction"),true)}}},handleUserAction:function(e){var f=(this.mobile&&e.touches)?e.touches[0].target:e.target;if(e.type=="touchmove"){f=document.elementFromPoint(e.pageX,e.pageY)}var d=this.lookForDetail(f);if(!d){if(this.isNavbarKey(e.target)){this.dispatchEvent(jQuery.fn.imagesActivesBasic.userEvents.STOP_FOOTER_AUTOMATIC_REMOVAL);var c=e.target.id.replace("index_","");d=this.detailNodes[c]}}switch(e.type){case"mouseover":case"touchmove":if(d){this.dispatchEvent(jQuery.fn.imagesActivesBasic.userEvents.HOVER_DETAIL,{detailId:d.id})}else{this.dispatchEvent(jQuery.fn.imagesActivesBasic.userEvents.UNSELECT_DETAIL,{})}break;case"gesturestart":case"gesturechange":case"gestureend":e.preventDefault();break;case"touchstart":this.yDepartTouche=e.pageY;this.xDepartTouche=e.pageX;case"mousedown":if($(e.target).closest(".close-button").is(this.creditPanelCloseButton)||$(e.target).is(this.creditPanelCloseButton)){e.preventDefault();this.displayCreditPanel(false);return}if(e.target==this.creditImage.get(0)){window.open("http://www.crdp.ac-versailles.fr");return}else{if(this.creditPanel.is(":visible")){this.displayCreditPanel(false)}}if($(e.target).hasClass("keypad-popup")||$(e.target).hasClass("keypad-key")||$(e.target).hasClass("keypad-row")){return}if($(e.target).hasClass("keypad-special")){this.dispatchEvent(jQuery.fn.imagesActivesBasic.userEvents.VALID_PASSWORD,{password:this.passwordInput.val()});return}if(this.answerButton&&e.target==this.answerButton.get(0)){this.dispatchEvent(jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_ANSWER);return}if(e.target==this.nextDetailButton.get(0)){e.preventDefault();this.dispatchEvent(jQuery.fn.imagesActivesBasic.userEvents.STOP_FOOTER_AUTOMATIC_REMOVAL);this.navigateInNavbar(1);return}if(e.target==this.previousDetailButton.get(0)){e.preventDefault();this.dispatchEvent(jQuery.fn.imagesActivesBasic.userEvents.STOP_FOOTER_AUTOMATIC_REMOVAL);this.navigateInNavbar(-1);return}if($(e.target).closest(".close-button").is(this.textBoxCloseButton)||$(e.target).is(this.textBoxCloseButton)){e.preventDefault();this.dispatchEvent(jQuery.fn.imagesActivesBasic.userEvents.HIDE_TEXT_BOX);return}if(this.passwordInput&&e.target==this.passwordInput.get(0)){e.preventDefault();return}if(e.target.tagName.toLowerCase()=="a"){return}var a=this.lookForHeaderButton(e.target);switch(a){case null:break;case jQuery.fn.imagesActivesBasic.UI.buttons.DETAILS:if(this.mobile){e.preventDefault()}this.dispatchEvent(jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_ALL_DETAILS);return;case jQuery.fn.imagesActivesBasic.UI.buttons.DESCRIPTION:if(this.mobile){e.preventDefault()}this.dispatchEvent(jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_DESCRIPTION,{});return;case jQuery.fn.imagesActivesBasic.UI.buttons.METADATA:if(this.mobile){e.preventDefault()}this.dispatchEvent(jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_METADATA,{});return;case jQuery.fn.imagesActivesBasic.UI.buttons.INFOS:if(this.mobile){e.preventDefault()}this.displayCreditPanel(true);return}var b=this.lookForTitleScrollButton(e.target);switch(b){case null:break;case this.leftScrollArrow:this.scrollTitle("left");break;case this.rightScrollArrow:this.scrollTitle("right");break}this.yDeplacementTouche=e.pageY;this.xDeplacementTouche=e.pageX;if($(e.target).hasClass("caption_text")){if(Math.abs(this.xDeplacementTouche-this.xDepartTouche)>Math.abs(this.yDeplacementTouche-this.yDepartTouche)){e.preventDefault()}else{if(parseInt(e.target.scrollTop,10)+parseInt(e.target.clientHeight,10)>=parseInt(e.target.scrollHeight,10)){if(this.yDepartTouche>this.yDeplacementTouche){e.preventDefault()}}else{if(parseInt(e.target.scrollTop,10)<1){if(this.yDepartTouche<this.yDeplacementTouche){e.preventDefault()}}}}}else{if($(e.target).hasClass("horizontal-scroll")){if(Math.abs(this.xDeplacementTouche-this.xDepartTouche)<Math.abs(this.yDeplacementTouche-this.yDepartTouche)){e.preventDefault()}else{if(parseInt(e.target.scrollLeft,10)+parseInt(e.target.clientWidth,10)>=parseInt(e.target.scrollWidth,10)){if(this.xDepartTouche>this.xDeplacementTouche){e.preventDefault()}}else{if(parseInt(e.target.scrollLeft,10)<1){if(this.xDepartTouche<this.xDeplacementTouche){e.preventDefault()}}}}this.updateArrows()}else{if(this.mobile){e.preventDefault()}}}if($(e.target).closest(".bouton-header-handle").length>0){this.dispatchEvent(jQuery.fn.imagesActivesBasic.userEvents.CLICK_HEADER_TAB)}else{if($(e.target).closest(".bouton-footer-handle").length>0){this.dispatchEvent(jQuery.fn.imagesActivesBasic.userEvents.CLICK_FOOTER_TAB)}else{if(d){this.dispatchEvent(jQuery.fn.imagesActivesBasic.userEvents.SELECT_DETAIL,{detailId:d.id})}else{if(e.target!=this.textBox.get(0)&&e.target.parentElement!=this.textBox.get(0)){this.dispatchEvent(jQuery.fn.imagesActivesBasic.userEvents.CLICK_OUTSIDE_DETAIL,{})}}}}break;case"mouseout":if(d){this.dispatchEvent(jQuery.fn.imagesActivesBasic.userEvents.UNSELECT_DETAIL,{detailId:d.id})}break}},emphasizeAllDetails:function(a){for(var b in this.detailNodes){this.emphasizeDetail(b,a)}},illuminateAllDetails:function(a){for(var b in this.detailNodes){this.illuminateDetail(b,a)}},emphasizeDetail:function(b,a){var c=this.detailNodes[b];if(!this.isPuce(c)){if(a){this.displayShader(this.dao.getCommonInteractivityParameter("shading_color"),parseFloat(this.dao.getCommonInteractivityParameter("shading_alpha")),b)}c.getElementsByTagName("rect")[0].setAttribute("opacity",a?0:1);c.getElementsByTagName("image")[0].setAttribute("opacity",a?1:0);this.detailOpacity(c,a?1:0)}else{this.hideShader();c.setAttribute("filter",a?"url(#dropshadow)":"")}this.footerContent.find("span#index_"+b).toggleClass("emphasized",a)},illuminateDetail:function(b,a){var c=this.detailNodes[b];if(!this.isPuce(c)){c.getElementsByTagName("rect")[0].setAttribute("opacity",a?1:0);if(c.getElementsByTagName("image").length>0){c.getElementsByTagName("image")[0].setAttribute("opacity",a?0:1)}c.setAttribute("opacity",a?parseFloat(this.dao.getCommonInteractivityParameter("shading_alpha")):0);this.footerContent.find("span#index_"+b).toggleClass("emphasized",a)}else{this.emphasizeDetail(b,a)}},zoomDetail:function(c){var b=(this.imageWidth-jQuery.fn.imagesActivesBasic.settings.zoom_margin*this.unity)/this.detailsDimensions[c].width;var d=(this.imageHeight-jQuery.fn.imagesActivesBasic.settings.zoom_margin*this.unity)/this.detailsDimensions[c].height;var h=parseFloat(this.dao.getCommonInteractivityParameter("zoom_duration"))/24*1000;var e=Math.min(b,d);var e=Math.min(e,1/(this.scaleFactor/3));var f=e/4;this.zoomFactor=e*this.scaleFactor;var a=-1*this.detailsDimensions[c].left*this.zoomFactor;var k=this.scaleFactor*(this.imageWidth-this.detailsDimensions[c].width*e)/2;var i=-1*this.detailsDimensions[c].top*this.zoomFactor;var g=this.scaleFactor*(this.imageHeight-this.detailsDimensions[c].height*e)/2;this.transX=a+k;this.transY=i+g;this.detailNodes[c].getElementsByTagName("rect")[0].setAttribute("opacity","0");this.detailNodes[c].setAttribute("opacity","1");this.displayShader(this.dao.getCommonInteractivityParameter("zoom_background_color"),parseFloat(this.dao.getCommonInteractivityParameter("zoom_background_alpha")),c);if(this.noZoomInterpolation){this.detailNodes[c].setAttribute("transform","translate("+this.transX+","+this.transY+") scale("+this.zoomFactor+") ");this.signalZoomEnd()}else{var j=$.proxy(this,"interpolateZoom");this.zoom=setInterval(j,h*f/jQuery.fn.imagesActivesBasic.settings.zoom_interpolation_frames);this.zoomProportion=0;this.zoomedDetailId=c}},interpolateZoom:function(){this.zoomProportion+=0.1;if(this.zoomProportion>1){clearInterval(this.zoom);this.signalZoomEnd();return}this.detailNodes[this.zoomedDetailId].setAttribute("transform","translate("+this.easing(this.transX,this.zoomProportion)+","+this.easing(this.transY,this.zoomProportion)+") scale("+(this.easing((this.zoomFactor-this.scaleFactor),this.zoomProportion)+this.scaleFactor)+") ")},signalZoomEnd:function(){this.dispatchEvent(jQuery.fn.imagesActivesBasic.userEvents.ZOOM_FINISHED)},easing:function(e,b){var d=b*b;var a=d*b;return e*(a+-2*d+2*b)},unzoomDetail:function(a){this.detailNodes[a].setAttribute("transform","scale("+this.scaleFactor+")");this.detailNodes[a].getElementsByTagName("rect")[0].setAttribute("opacity","1")},toggleButton:function(b,a){this.headerButtons[b].toggleClass("emphasized",a)},dispatchEvent:function(a,b){jQuery(this).trigger(jQuery.Event(a,b))},createVectorImage:function(a){var b;if(jQuery.fn.imagesActivesBasic.settings.embedSvgIcons=="noembed"){b=jQuery(document.createElement("img"));b.attr("src","img/"+a+".svg")}else{b=jQuery(document.createElement("span"));content=$("svg#"+a).clone();content.attr("id","");b.append(content)}return b}};jQuery.fn.imagesActivesBasic.Control=function(b,a){this.ui=b;this.dao=a;this.quizLocked=this.dao.getInteractivityType()=="quiz"&&this.dao.getSpecificInteractivityParameter("quiz_lock")==1;this.precedentState=this.currentState=null;this.selectedDetailId="";this.statesIndex=jQuery.fn.imagesActivesBasic.Control.states;this.createStates();this.switchState("DEFAULT");this.listenToUI();this.displayHeaderAtStart();this.displayFooterAtStart();this.ui.fitToViewport()};jQuery.fn.imagesActivesBasic.Control.states={DEFAULT:"Default",EMPHASIS_ONE:"EmphasisOne",DETAIL_CAPTION:"DetailCaption",DETAIL_QUESTION:"DetailQuestion",OVERALL_CAPTION:"OverallCaption",METADATA:"Metadata",ZOOM:"Zoom",EMPHASIZE_ALL:"EmphasisAll"};jQuery.fn.imagesActivesBasic.Control.prototype={displayHeaderAtStart:function(){this.showHeader();this.displayHeaderAtStartTimer=setTimeout(jQuery.proxy(this,"hideHeader"),jQuery(this.svg).imagesActivesBasic.settings.panels_hiding_delay)},displayFooterAtStart:function(){this.showFooter();this.displayFooterAtStartTimer=setTimeout(jQuery.proxy(this,"hideFooter"),jQuery(this.svg).imagesActivesBasic.settings.panels_hiding_delay)},stopRemovingHeaderAtStart:function(){clearTimeout(this.displayHeaderAtStartTimer)},stopRemovingFooterAtStart:function(){clearTimeout(this.displayFooterAtStartTimer)},createStates:function(){var b;this.states=new Object();for(var a in this.statesIndex){b=this.statesIndex[a];this.states[b]=new jQuery.fn.imagesActivesBasic[b+"State"](this,this.ui,this.dao)}},hideHeader:function(){if(this.ui.displayHeader(false)){this.headerVisible=false}},showHeader:function(){if(this.ui.displayHeader(true)){this.headerVisible=true}},hideFooter:function(){if(this.ui.displayFooter(false)){this.footerVisible=false}},showFooter:function(){if(this.ui.displayFooter(true)){this.footerVisible=true}},toggleHeader:function(){this.headerVisible?this.hideHeader():this.showHeader()},toggleFooter:function(){this.footerVisible?this.hideFooter():this.showFooter()},listenToUI:function(){for(var a in jQuery.fn.imagesActivesBasic.userEvents){jQuery(this.ui).bind(jQuery.fn.imagesActivesBasic.userEvents[a],jQuery.proxy(this,"commonHandling"))}},commonHandling:function(a){switch(a.type){case jQuery.fn.imagesActivesBasic.userEvents.CLICK_HEADER_TAB:this.stopRemovingHeaderAtStart();this.toggleHeader();break;case jQuery.fn.imagesActivesBasic.userEvents.CLICK_FOOTER_TAB:this.stopRemovingFooterAtStart();this.toggleFooter();break;case jQuery.fn.imagesActivesBasic.userEvents.STOP_HEADER_AUTOMATIC_REMOVAL:this.stopRemovingHeaderAtStart();break;case jQuery.fn.imagesActivesBasic.userEvents.STOP_FOOTER_AUTOMATIC_REMOVAL:this.stopRemovingFooterAtStart();break;default:this.specificHandling(a);break}},specificHandling:function(a){this.currentState.handleUserEvent(a)},switchState:function(a){if(this.currentState){this.currentState.quit()}this.precedentState=this.currentState;this.currentState=this.states[jQuery.fn.imagesActivesBasic.Control.states[a]];this.currentState.entry()},isComingFrom:function(a){return this.precedentState&&this.precedentState==this.states[jQuery.fn.imagesActivesBasic.Control.states[a]]}};jQuery.fn.imagesActivesBasic.DefaultState=function(c,b,a){this.control=c;this.ui=b;this.dao=a};jQuery.fn.imagesActivesBasic.DefaultState.prototype={handleUserEvent:function(a){switch(a.type){case jQuery.fn.imagesActivesBasic.userEvents.HOVER_DETAIL:this.control.selectedDetailId=a.detailId;this.control.switchState("EMPHASIS_ONE");break;case jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_ALL_DETAILS:this.control.switchState("EMPHASIZE_ALL");break;case jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_DESCRIPTION:this.control.switchState("OVERALL_CAPTION");break;case jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_METADATA:this.control.switchState("METADATA");break;case jQuery.fn.imagesActivesBasic.userEvents.SELECT_DETAIL:this.control.selectedDetailId=a.detailId;if(this.dao.getInteractivityType()=="discovery"){this.control.switchState("DETAIL_CAPTION")}else{if(this.dao.getInteractivityType()=="quiz"){this.control.switchState("DETAIL_QUESTION")}}break}},entry:function(){if(this.control.selectedDetailId!=""){this.ui.emphasizeDetail(this.control.selectedDetailId,false);this.ui.hideShader()}this.control.selectedDetailId=""},quit:function(){}};jQuery.fn.imagesActivesBasic.EmphasisOneState=function(c,b,a){this.control=c;this.ui=b;this.dao=a};jQuery.fn.imagesActivesBasic.EmphasisOneState.prototype={handleUserEvent:function(b){switch(b.type){case jQuery.fn.imagesActivesBasic.userEvents.UNSELECT_DETAIL:this.control.switchState("DEFAULT");break;case jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_ALL_DETAILS:this.control.switchState("EMPHASIZE_ALL");break;case jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_DESCRIPTION:this.control.switchState("OVERALL_CAPTION");break;case jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_METADATA:this.control.switchState("METADATA");break;case jQuery.fn.imagesActivesBasic.userEvents.SELECT_DETAIL:if(b.detailId==this.control.selectedDetailId){if(this.dao.getInteractivityType()=="discovery"){var d=this.dao.getDetailTitle(this.control.selectedDetailId);var c=this.dao.getDetailDesc(this.control.selectedDetailId);var a=(d+c).match(/^\s*$/);if(a){if(this.ui.isDetailZoomable(this.control.selectedDetailId)){this.control.switchState("ZOOM")}}else{this.control.switchState("DETAIL_CAPTION")}}else{if(this.dao.getInteractivityType()=="quiz"){this.control.switchState("DETAIL_QUESTION")}}}else{this.control.selectedDetailId=b.detailId;this.control.switchState("EMPHASIS_ONE")}break;case jQuery.fn.imagesActivesBasic.userEvents.HOVER_DETAIL:if(b.detailId!=this.control.selectedDetailId){this.control.selectedDetailId=b.detailId;this.control.switchState("EMPHASIS_ONE")}break}},entry:function(){this.ui.emphasizeAllDetails(false);this.ui.emphasizeDetail(this.control.selectedDetailId,true)},quit:function(){}};jQuery.fn.imagesActivesBasic.DetailCaptionState=function(c,b,a){this.control=c;this.ui=b;this.dao=a};jQuery.fn.imagesActivesBasic.DetailCaptionState.prototype={handleUserEvent:function(a){switch(a.type){case jQuery.fn.imagesActivesBasic.userEvents.UNSELECT_DETAIL:if(this.ui.mobile){this.control.switchState("DEFAULT")}break;case jQuery.fn.imagesActivesBasic.userEvents.CLICK_OUTSIDE_DETAIL:this.control.switchState("DEFAULT");break;case jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_ALL_DETAILS:this.control.switchState("EMPHASIZE_ALL");break;case jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_DESCRIPTION:this.control.switchState("OVERALL_CAPTION");break;case jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_METADATA:this.control.switchState("METADATA");break;case jQuery.fn.imagesActivesBasic.userEvents.SELECT_DETAIL:if(a.detailId==this.control.selectedDetailId){if(this.ui.isDetailZoomable(this.control.selectedDetailId)){this.control.switchState("ZOOM")}else{this.control.switchState("DEFAULT")}}else{this.control.selectedDetailId=a.detailId;if(this.dao.getInteractivityType()=="discovery"){this.control.switchState("DETAIL_CAPTION")}else{if(this.dao.getInteractivityType()=="quiz"){this.control.switchState("DETAIL_QUESTION")}}}break;case jQuery.fn.imagesActivesBasic.userEvents.HIDE_TEXT_BOX:this.control.switchState("DEFAULT");break}},entry:function(){if(!this.control.isComingFrom("EMPHASIS_ONE")){this.ui.emphasizeAllDetails(false);this.ui.emphasizeDetail(this.control.selectedDetailId,true)}var c=this.dao.getDetailTitle(this.control.selectedDetailId);var b=this.dao.getDetailDesc(this.control.selectedDetailId);var a=(c+b).match(/^\s*$/);if(!a){this.ui.displayCaption(this.control.selectedDetailId,c,b)}},quit:function(){this.ui.hideCaption()}};jQuery.fn.imagesActivesBasic.DetailQuestionState=function(c,b,a){this.control=c;this.ui=b;this.dao=a};jQuery.fn.imagesActivesBasic.DetailQuestionState.prototype={handleUserEvent:function(a){switch(a.type){case jQuery.fn.imagesActivesBasic.userEvents.UNSELECT_DETAIL:if(this.ui.mobile){this.control.switchState("DEFAULT")}break;case jQuery.fn.imagesActivesBasic.userEvents.CLICK_OUTSIDE_DETAIL:this.control.switchState("DEFAULT");break;case jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_ALL_DETAILS:this.control.switchState("EMPHASIZE_ALL");break;case jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_DESCRIPTION:this.control.switchState("OVERALL_CAPTION");break;case jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_METADATA:this.control.switchState("METADATA");break;case jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_ANSWER:this.answerDisplayed=true;this.refreshTextBox();break;case jQuery.fn.imagesActivesBasic.userEvents.VALID_PASSWORD:this.validatePasswordInput(a.password);break;case jQuery.fn.imagesActivesBasic.userEvents.SELECT_DETAIL:if(a.detailId==this.control.selectedDetailId){if(this.ui.isDetailZoomable(this.control.selectedDetailId)){this.control.switchState("ZOOM")}else{this.control.switchState("DEFAULT")}}else{this.control.selectedDetailId=a.detailId;if(this.dao.getInteractivityType()=="discovery"){this.control.switchState("DETAIL_CAPTION")}else{if(this.dao.getInteractivityType()=="quiz"){this.control.switchState("DETAIL_QUESTION")}}}break;case jQuery.fn.imagesActivesBasic.userEvents.HIDE_TEXT_BOX:this.control.switchState("DEFAULT");break}},validatePasswordInput:function(a){if(this.dao.getSpecificInteractivityParameter("quiz_password")==a){this.control.quizLocked=false;this.answerDisplayed=true}this.refreshTextBox()},entry:function(){if(!this.control.isComingFrom("EMPHASIS_ONE")){this.ui.emphasizeAllDetails(false);this.ui.emphasizeDetail(this.control.selectedDetailId,true)}this.answerDisplayed=false;this.refreshTextBox()},refreshTextBox:function(){var b="";var a=this.dao.getDetailTitle(this.control.selectedDetailId);if(this.answerDisplayed){b=this.dao.getDetailDesc(this.control.selectedDetailId)}else{b=""}this.ui.displayPasswordInput(this.control.quizLocked);if(this.control.quizLocked){this.control.stopRemovingHeaderAtStart()}this.ui.displayAnswerButton(!this.answerDisplayed&&!this.control.quizLocked);this.ui.displayCaption(this.control.selectedDetailId,a,b,!this.answerDisplayed)},quit:function(){if(this.ui.passwordInput){this.ui.displayPasswordInput(false)}if(this.ui.answerButton){this.ui.displayAnswerButton(false)}this.ui.hideCaption()}};jQuery.fn.imagesActivesBasic.OverallCaptionState=function(c,b,a){this.control=c;this.ui=b;this.dao=a};jQuery.fn.imagesActivesBasic.OverallCaptionState.prototype={handleUserEvent:function(a){switch(a.type){case jQuery.fn.imagesActivesBasic.userEvents.CLICK_OUTSIDE_DETAIL:this.control.switchState("DEFAULT");break;case jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_ALL_DETAILS:this.control.switchState("EMPHASIZE_ALL");break;case jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_METADATA:this.control.switchState("METADATA");break;case jQuery.fn.imagesActivesBasic.userEvents.SELECT_DETAIL:this.control.selectedDetailId=a.detailId;if(this.dao.getInteractivityType()=="discovery"){this.control.switchState("DETAIL_CAPTION")}else{if(this.dao.getInteractivityType()=="quiz"){this.control.switchState("DETAIL_QUESTION")}}break;case jQuery.fn.imagesActivesBasic.userEvents.HIDE_TEXT_BOX:this.control.switchState("DEFAULT");break}},entry:function(){this.control.stopRemovingHeaderAtStart();if(!this.control.isComingFrom("EMPHASIS_ONE")){this.ui.emphasizeAllDetails(false);this.control.selectedDetailId="";this.ui.hideShader()}var b="";var a="";if(this.dao.getInteractivityType()=="discovery"){b=this.dao.getDetailTitle(jQuery.fn.imagesActivesBasic.DAO.OVERALL_DESCRIPTION);a=this.dao.getDetailDesc(jQuery.fn.imagesActivesBasic.DAO.OVERALL_DESCRIPTION)}else{if(this.dao.getInteractivityType()=="quiz"){b=this.dao.getSpecificText("quiz_instruction_title");a=this.dao.getSpecificText("quiz_instruction_text")}}if(this.ui.passwordInput){this.ui.displayPasswordInput(false)}if(this.ui.answerButton){this.ui.displayAnswerButton(false)}this.ui.displayCaption(jQuery.fn.imagesActivesBasic.DAO.OVERALL_DESCRIPTION,b,a)},quit:function(){this.ui.hideCaption()}};jQuery.fn.imagesActivesBasic.MetadataState=function(c,b,a){this.control=c;this.ui=b;this.dao=a};jQuery.fn.imagesActivesBasic.MetadataState.prototype={handleUserEvent:function(a){switch(a.type){case jQuery.fn.imagesActivesBasic.userEvents.CLICK_OUTSIDE_DETAIL:this.control.switchState("DEFAULT");break;case jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_ALL_DETAILS:this.control.switchState("EMPHASIZE_ALL");break;case jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_DESCRIPTION:this.control.switchState("OVERALL_CAPTION");break;case jQuery.fn.imagesActivesBasic.userEvents.SELECT_DETAIL:this.control.selectedDetailId=a.detailId;if(this.dao.getInteractivityType()=="discovery"){this.control.switchState("DETAIL_CAPTION")}else{if(this.dao.getInteractivityType()=="quiz"){this.control.switchState("DETAIL_QUESTION")}}break;case jQuery.fn.imagesActivesBasic.userEvents.HIDE_TEXT_BOX:this.control.switchState("DEFAULT");break}},entry:function(){this.control.stopRemovingHeaderAtStart();if(!this.control.isComingFrom("EMPHASIS_ONE")){this.ui.emphasizeAllDetails(false);this.control.selectedDetailId="";this.ui.hideShader()}if(this.ui.passwordInput){this.ui.displayPasswordInput(false)}if(this.ui.answerButton){this.ui.displayAnswerButton(false)}this.ui.displayCaption(jQuery.fn.imagesActivesBasic.DAO.OVERALL_DESCRIPTION,this.dao.getMetadataTitle(),this.dao.getMetadataContent())},quit:function(){this.ui.hideCaption()}};jQuery.fn.imagesActivesBasic.ZoomState=function(c,b,a){this.control=c;this.ui=b;this.dao=a};jQuery.fn.imagesActivesBasic.ZoomState.prototype={handleUserEvent:function(a){switch(a.type){case jQuery.fn.imagesActivesBasic.userEvents.SELECT_DETAIL:case jQuery.fn.imagesActivesBasic.userEvents.CLICK_OUTSIDE_DETAIL:if(!this.zoomRunning){this.control.switchState("DEFAULT")}break;case jQuery.fn.imagesActivesBasic.userEvents.ZOOM_FINISHED:this.zoomRunning=false;break;default:break}},entry:function(){this.zoomRunning=true;this.ui.footer.hide();this.ui.footerHandleUp.hide();this.ui.footerHandleDown.hide();this.ui.header.hide();this.ui.headerHandleUp.hide();this.ui.headerHandleDown.hide();this.ui.zoomDetail(this.control.selectedDetailId)},quit:function(){this.ui.footer.show();this.ui.updateFooterHandleIcon();this.ui.header.show();this.ui.updateHeaderHandleIcon();this.ui.unzoomDetail(this.control.selectedDetailId)}};jQuery.fn.imagesActivesBasic.EmphasisAllState=function(c,b,a){this.control=c;this.ui=b;this.dao=a};jQuery.fn.imagesActivesBasic.EmphasisAllState.prototype={handleUserEvent:function(a){switch(a.type){case jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_ALL_DETAILS:this.control.switchState("DEFAULT");return;break;case jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_DESCRIPTION:this.control.switchState("OVERALL_CAPTION");break;case jQuery.fn.imagesActivesBasic.userEvents.DISPLAY_METADATA:this.control.switchState("METADATA");break;case jQuery.fn.imagesActivesBasic.userEvents.SELECT_DETAIL:this.control.selectedDetailId=a.detailId;if(this.dao.getInteractivityType()=="discovery"){this.control.switchState("DETAIL_CAPTION")}else{if(this.dao.getInteractivityType()=="quiz"){this.control.switchState("DETAIL_QUESTION")}}break;case jQuery.fn.imagesActivesBasic.userEvents.HOVER_DETAIL:break;default:this.control.switchState("DEFAULT");break}},entry:function(){this.control.stopRemovingHeaderAtStart();this.ui.hideShader();this.ui.illuminateAllDetails(true);this.ui.toggleButton(jQuery.fn.imagesActivesBasic.UI.buttons.DETAILS,true)},quit:function(){this.ui.illuminateAllDetails(false);this.ui.toggleButton(jQuery.fn.imagesActivesBasic.UI.buttons.DETAILS,false)}};